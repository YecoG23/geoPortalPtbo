{% extends "base.html" %}
{% load static %}
{% load geojson_tags %}

{% block title %}Inicio{% endblock title %}

{% block custom_style %}

<link rel="stylesheet" href="https://cdn.datatables.net/1.10.20/css/jquery.dataTables.min.css">

<style>
	#mapid { height: 500px; }
</style>

{% endblock custom_style %}

{% block datatables_js %}
  <script src="https://cdn.datatables.net/1.10.20/js/jquery.dataTables.min.js"></script>
<!--   <script src="https://cdn.datatables.net/1.10.20/js/dataTables.bootstrap4.min.js"></script>
 -->
  <script>
    $(document).ready(function() {
    $('#example').DataTable(
     {
            "language": {
    "decimal":        "",
    "emptyTable":     "No hay datos que mostrar",
    "info":           "Mostrando _START_ a _END_ de _TOTAL_ filas",
    "infoEmpty":      "Mostrando 0 a 0 de 0 filas",
    "infoFiltered":   "(filtrado de _MAX_ total filas)",
    "infoPostFix":    "",
    "thousands":      ",",
    "lengthMenu":     "Mostrar _MENU_ filas",
    "loadingRecords": "Cargando...",
    "processing":     "Procesando...",
    "search":         "Buscar:",
    "zeroRecords":    "No existe datos segun busqueda",
    "paginate": {
        "first":      "Primero",
        "last":       "Ultimo",
        "next":       "Siguiente",
        "previous":   "Anterior"
    },
    "aria": {
        "sortAscending":  ": activar para ordenar en forma ascendente",
        "sortDescending": ": activar para ordenar en forma descendente"
    }
}
        } 
 );
} );
</script>
{% endblock %}

{% block content %}


<div class="container-fluid" id="mapid">
</div>

<div class="mt-5 pb-5">
<!-- TABLE SHOWING INFORMATION -->
<table id="example" class="display" style="width:100%">
        <thead>
            <tr>
                <th>Nombre</th>
                <th>Ubicacion</th>
                <th>Localidad</th>
                <th>Fecha creacion</th>
            </tr>
        </thead>
        <tbody>
                {%for pro in proyectos %}
                <tr>
                    <td>
                        {{pro.nombre}}
                    </td>
                    <td>
                        {{pro.geom.x}}, {{pro.geom.y}}
                    </td>
                    <td>
                        {{pro.localidad}}
                    </td>
                    <td>
                        {{pro.fecha_creacion}}
                    </td>
                </tr>
                {% endfor %}  
        </tbody>
        <tfoot>
            <tr>
                <th>Nombre</th>
                <th>Ubicacion</th>
                <th>Localidad</th>
                <th>Fecha creacion</th>
            </tr>
        </tfoot>
    </table>
</div>

<script>
	var dataurl = "{% url 'data' %}";
    // Download GeoJSON via Ajax
    $.getJSON(dataurl, function (data) {
    	var mymap = L.map('mapid').setView([-10.774303, -75.813227], 13);
    	L.tileLayer('https://api.mapbox.com/styles/v1/{id}/tiles/{z}/{x}/{y}?access_token=pk.eyJ1IjoieWVjbzIzIiwiYSI6ImNrNnZvdnNhdjAwM2Uza285cnVzejFnbGcifQ.NY_Z2Zm2h7wH2LWo9-HGCw', {
    		attribution: 'Map data &copy; <a href="https://www.openstreetmap.org/">OpenStreetMap</a> contributors, <a href="https://creativecommons.org/licenses/by-sa/2.0/">CC-BY-SA</a>, Imagery Â© <a href="https://www.mapbox.com/">Mapbox</a>',
    		maxZoom: 18,
    		id: 'mapbox/streets-v11',
    		tileSize: 512,
    		zoomOffset: -1,
    		accessToken: 'your.mapbox.access.token'
    	}).addTo(mymap);

        // Add GeoJSON layer
        // L.geoJson(data).addTo(mymap);

        // var layerGroup = L.geoJSON(data, {
        //   onEachFeature: function (feature, layer) {
        //     layer.bindPopup('<h1>'+feature.properties.model["nombre"]+'</h1><p>nombre: '+feature.properties.model+'</p>');
        //   }
        // }).addTo(mymap);


        var collection = {{ proyectos |geojsonfeature:"popupContent"|safe }};
        function onEachFeature(feature, layer) {
            if (feature.properties && feature.properties.popupContent) {
              layer.bindPopup(feature.properties.popupContent);
            }
          }

        L.geoJson(collection, {onEachFeature: onEachFeature}).addTo(mymap);


    });

</script>
{% endblock %}

